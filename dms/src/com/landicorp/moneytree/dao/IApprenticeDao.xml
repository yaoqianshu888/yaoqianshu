<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<!-- 命名空间 -->
<mapper namespace="com.landicorp.moneytree.dao.IApprenticeDao">
	<resultMap id="apprentice" type="apprentice">
		<result property="id" column="id" />
		<result property="apprenticeName" column="apprentice_name" />
		<result property="user.id" column="user_id" />
		<result property="status" column="status" />
		<result property="wordRebate" column="word_rebate" />
		<result property="createTime" column="CREATE_TIME" />
		<result property="creator.id" column="CREATOR" />
		<result property="lastModifyTime" column="LAST_MODIFY_TIME" />
		<result property="lastModifier.id" column="LAST_MODIFIER" />
		<result property="memo" column="MEMO" />
		<result property="wordTimes" column="word_times" />
		<result property="zodiacRebate" column="zodiac_rebate" />
		<result property="zodiacTimes" column="zodiac_times" />
		<association property="creator" column="creator"
			javaType="com.landicorp.core.entities.User" select="com.landicorp.core.dao.IUserDao.getById" />
		<association property="lastModifier" column="LAST_MODIFIER"
			javaType="com.landicorp.core.entities.User" select="com.landicorp.core.dao.IUserDao.getById" />
	</resultMap>
	<sql id="keyColumns">apprentice_name,user_id,status,word_rebate,CREATE_TIME,
		CREATOR,LAST_MODIFY_TIME,LAST_MODIFIER,MEMO,word_times,zodiac_rebate,zodiac_times</sql>
	<sql id="valueColumns">#{apprenticeName, jdbcType=VARCHAR},#{user.id,
		jdbcType=NUMERIC},
		#{status,jdbcType=NUMERIC},#{wordRebate, jdbcType=VARCHAR},#{createTime,jdbcType=TIMESTAMP},
		#{creator.id,jdbcType=NUMERIC},#{lastModifyTime,jdbcType=TIMESTAMP},#{lastModifier.id,jdbcType=NUMERIC},
		#{memo, jdbcType=VARCHAR},#{wordTimes, jdbcType=VARCHAR},#{zodiacRebate, jdbcType=VARCHAR},#{zodiacTimes, jdbcType=VARCHAR}
	</sql>
	
	<sql id="whereColumns">
			<if
				test="apprentice!=null and apprentice.apprenticeName!=null and apprentice.apprenticeName!=''">
				and t1.apprentice_name like '%${apprentice.apprenticeName}%'
			</if>
			and t1.user_id=#{apprentice.user.id}
	</sql>
	
	<insert id="save" parameterType="apprentice">
		insert into t_moneytree_apprentice
		(
		<include refid="keyColumns" />
		) values(
		<include refid="valueColumns" />
		)
		<!-- 配置Mysql主键自动增长 -->
		<selectKey resultType="int" keyProperty="id">
			select
			LAST_INSERT_ID() as value  
		</selectKey>
	</insert>
	<update id="update" parameterType="apprentice">
		update t_moneytree_apprentice
		<set>
			<if test="apprenticeName!=null">apprentice_name=#{apprenticeName},</if>
			<if test="user!=null and user.id!=null">user_id=#{user.id},</if>
			<if test="status!=null">status=#{status},</if>
			<if test="createTime!=null">CREATE_TIME=#{createTime},</if>
			<if test="creator!=null and creator.id!=null">
				CREATOR=#{creator.id},
			</if>
			<if test="lastModifyTime!=null">
				LAST_MODIFY_TIME=#{lastModifyTime},
			</if>
			<if test="lastModifier!=null and lastModifier.id!=null">
				LAST_MODIFIER=#{lastModifier.id},
			</if>
			<if test="wordRebate!=null">word_rebate=#{wordRebate},</if>
			<if test="wordTimes!=null">word_times=#{wordTimes},</if>
			<if test="zodiacRebate!=null">zodiac_rebate=#{zodiacRebate},</if>
			<if test="zodiacTimes!=null">zodiac_times=#{zodiacTimes},</if>
			<if test="memo!=null">MEMO=#{memo}</if>
		</set>
		where id=#{id}
	</update>
	<delete id="delete" parameterType="int">
		delete from t_moneytree_apprentice where
		id in
		<foreach collection="array" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	<select id="getById" parameterType="int" resultMap="apprentice">
		select *
		from
		t_moneytree_apprentice
		where id=#{id} 
            
	</select>
	
	<select id="getApprenticeListByApprentice" parameterType="map"
		resultMap="apprentice">
		select * from t_moneytree_apprentice t1
		<where>
			<include refid="whereColumns" />
		</where>		
		order by t1.ID desc
		<include refid="Sql.pager" />
	</select>
	<select id="getApprenticeCountByApprentice" parameterType="map" resultType="int">
		select count(*) from t_moneytree_apprentice t1
		<where>
			<include refid="whereColumns" />
		</where>		
	</select>
	<select id="getAllApprentice" resultMap="apprentice" parameterType="map">
		SELECT
		*
		FROM t_moneytree_apprentice where user_id=#{apprentice.user.id}
		ORDER BY ID DESC
		<include refid="Sql.pager" />
	</select>
	<select id="getAllApprenticeCount" resultType="int" parameterType="map">
		select count(*) from t_moneytree_apprentice where user_id=#{apprentice.user.id}
	</select>
	
</mapper>